---
output:
    html_document:
        toc: yes
params:
    title: 'AJUBA_BC (Computational)'
    working_folder: '/Users/cowfox/Desktop/_rna_lib_analysis/__analysis/2018_12_10-ML_Random_Forest-Tuning'
    
    # Dataset "codename" - ONE at a time!!
    # Possible datasets - neil1_computational, neil1_experimental, neil1_degenerate_computational, ajuba_bc_computational, ttyh2_computational,  ttyh2_ecs_bc_experimental, ttyh2_bc_computational, ttyh2_bc_degenerate_computational, HEK293.WT1, Hela_no_gRNA, Hela_no_gRNA+IFN, u87_ctrl_vs_kd
    dataset_codename_str: 'ajuba_bc_computational'

# 
title: "Publication Plots - `r params$title`"
---

```{r "knitr config", cache = FALSE, include=FALSE}
require("knitr")
# 
script_folder_path = getwd()
if (params$working_folder != '') {
    # Set it "globally"
    opts_knit$set(root.dir = params$working_folder)
}

# Global Chunk Options
# Ref - https://yihui.name/knitr/options/
opts_chunk$set(
    echo = TRUE,
    message = FALSE
)
```

```{r Info, include=FALSE}
# ## Purpose of This Script
# It aims to run "Random Forest" on the RNA Liv data. 
# 
# ## Tutorial of Rmarkdown
# - https://bookdown.org/yihui/rmarkdown/
```

```{r Libraries, include=FALSE}
#
library(knitr)

# Plot
library(gplots)
library(ggplot2)
# ggpubr - ggplot2-based publication ready plots
# http://www.sthda.com/english/articles/24-ggpubr-publication-ready-plots/
library(ggpubr)
library(Hmisc)
library(corrplot)

library(doMC)  # Multi-core

# Tools
library(dplyr)
library(onehot)
library(rlist)
library(gtools)
library(gsubfn)
library(GetoptLong) # String interpolation - https://cran.r-project.org/web/packages/GetoptLong/vignettes/variable_interpolation.html
```

```{r Setup, include=FALSE}
# Clear - NO NEED. It needs "passing params"
# rm(list=ls())

# Global options
options(warn=-1)

# Use multi-core
registerDoMC(cores=8)

# Local scripts
# source(normalizePath(file.path(script_folder_path, './utils.R')))
# source(normalizePath(file.path(script_folder_path, './helper.R')))
source(normalizePath(file.path(script_folder_path, '../_util/plots.R')))
```

```{r Prep, include=FALSE}
# Set the "Seed" for following "Random Forest" running
seed_num = 166
set.seed(seed_num)
```

# Summary

It contains the "publication-level" figures of "Neil1 (Computational)"

```{r Load datasets, echo=FALSE, warning=FALSE}

# Temp fix
# - Use `setwd()` tp set the "working folder" since `opts_knit$set(root.dir = params$working_folder)` not working.
# - Ignore "warning" in this chunk
if (params$working_folder != '') {
    setwd(params$working_folder)
}

# 
dataset.one = params$dataset_codename_str

# Loop into "codenames" and build the "dataset variables"
# file path
file_path = GetoptLong::qq("./_output/feature_matrices/@{dataset.one}.features.csv")
assign(GetoptLong::qq("feature_file_relative_path.@{dataset.one}"), file_path)

# original data
data_orig = read.csv(file=file_path, header=TRUE, sep=",")
assign(GetoptLong::qq("data_orig.@{dataset.one}"), data_orig)

```

```{r Pre-processing, echo=FALSE}

#
dataset.name = GetoptLong::qq("data_orig.@{dataset.one}")
dataset = get(dataset.name)

# Remove records whose "editing level" is "NA"
column_to_predict='editing_value'
dataset = dataset[ is.na(dataset[ , column_to_predict])==FALSE, ]

# Save
assign(dataset.name, dataset)
```

# Histrogram

- editing_level

## `editing_level`

```{r Histrogram - editing_level, echo=FALSE, fig.width=8, fig.height=6}

dataset.filtered = select(dataset, c('rna_id', 'editing_value', 'mut_type'))

# Transform - Editing Level
# Use "quantitle" to split "editing level"
dataset.filtered$editing_value_orig = dataset.filtered$editing_value
probs <- seq(0, 1, by = 0.25)
quantiles <- quantile(dataset.filtered$editing_value, prob = probs)
dataset.filtered$editing_value <- cut(dataset.filtered$editing_value, 
           # quantiles,
           breaks = quantiles,
           labels = c("0-25", "25-50", "50-75", "75-100"),
           include.lowest = TRUE)

# Write as external file
# write.csv(dataset.filtered, file = "ajuba_bc-editing_level-quantile.csv")

# WT Editing Level
wt_editing_value = 0.351

histogram.editing_level <- gghistogram(dataset.filtered, 
            x = "editing_value_orig",
            y = "..count..",
            xlab = "Editing Level",
            ylab = "count",
            
            binwidth = 0.01, 
            
            # add = "mean",
            # rug = TRUE,
            
            fill = "editing_value", color = "editing_value",
            legend.title = "Editing Value Quantile",
            
            xticks.by = 0.1, 
            
            # palette = c("#00AFBB", "#E7B800")
            # label = "gene", label.select = key.gns, repel = TRUE,
            # font.label = list(color= "citation_index"),
            # xticks.by = 20, # Break x ticks by 20
            # gradient.cols = c("blue", "red"),
            # legend = c(0.7, 0.6),                                 
            # legend.title = ""       # Hide legend title
            ) + 
    font("legend.title", size = 12, color = "black", face = "plain") +
    font("legend.text", size = 12, color = "black", face = "plain") +
    
    # Axis
    font("xlab", size = 20, color = "black", face = "plain") +
    font("ylab", size = 20, color = "black", face = "plain") +
    font("xy.text", size = 16, color = "black", face = "plain") +
    # Add "annotation" for "WT"
    geom_point(
        aes(x = wt_editing_value, y = 0), 
        
        colour="#FC4E07",
        size = 3
        ) + 
    annotate("text", 
             x = wt_editing_value, y = -4, 
             
             # Use 'parse' to bold
             # label='atop(bold("WT: 0.64"))', 
             # parse = TRUE,
             
             label = GetoptLong::qq("WT: @{wt_editing_value}"), 
             fontface = 2,
             
             colour="#FC4E07",
             size = 5
             )
    # Arrow
    # annotate("segment", x=10,xend=10,y=20,yend=0,arrow=arrow(), color="blue") +  
# 
histogram.editing_level

# 
ggarrange(histogram.editing_level, ncol = 1) %>%
  ggexport(
      filename = GetoptLong::qq("histogram-@{params$dataset_codename_str}-editing_level-distribution.pdf")
      )
```


# Boxplot

The following "ML features" are considered: 

- mut_nt
- mut_ref_nt
- mut_ref_struct
- mut_prev_struct
- mut_next_struct
- site_struct
- site_1_1
- site_prev_nt
- site_next_nt
- num_mutations
- free_energy
- all_stem_length
- site_length
- u_all_stem_length
- u_hairpin_length
- u1_length
- d_all_stem_length
- d1_length
- u_count
- sim_nor_score

## `mut_nt`

- Remove rows with "empty value"

```{r BoxPlot - mut_nt, echo=FALSE, fig.width=6, fig.height=6}

# Feature Name
feature.name = 'mut_nt'
feature.label = 'mut_nt'

# Build "temp" dataset for plot
dataset.filtered = select(dataset, c('rna_id', 'editing_value', feature.name))
dataset.filtered = dataset.filtered[ !dataset.filtered[ , feature.name] %in% c('') , ]

#  For "Pairwise Comparisons"
p_value_comparisons = list( 
    c("A", "G"), 
    c("A", "C"), 
    c("A", "U")
)

# Box Plot
boxplot.mut_type <- ggboxplot(dataset.filtered, 
               y = "editing_value",
               x = feature.name, 
               color = feature.name, 
               
               # If show "legend"
               # legend = "none",
               legend.title = feature.label,
               
               # Text
               # title = "Box Plot created with ggpubr",
               # subtitle = "Length by dose",
               # caption = "Source: ggpubr",
               xlab = feature.label, 
               ylab = "Editing Level",
               
               # Color Palette
               palette = "jco",
               add = "jitter",
               # shape = "site_struct" 
               
               bxp.errorbar = TRUE,
               
               # Outlier
               outlier.colour = "red", 
               outlier.shape = NA,
               # outlier.shape = 8,  # outlier.shape = NA,
               outlier.alpha = 0.5, 
               outlier.size = 2,
               
               # 
               ggtheme = theme_pubr() 
    ) + 
    # Add a baseline
    geom_hline(yintercept = mean(dataset$editing_value), linetype = 2) +

    # Fonts
    # face - "plain","bold","italic","bold.italic"
    # font("title", size = 14, color = "red", face = "bold.italic") +
    # font("subtitle", size = 10, color = "orange") +
    # font("caption", size = 10, color = "orange") +
    
    # Change the appearance of legend title and texts
    font("legend.title", size = 12, color = "black", face = "plain") +
    font("legend.text", size = 12, color = "black", face = "plain") +
    
    # Axis
    font("xlab", size = 20, color = "black", face = "plain") +
    font("ylab", size = 20, color = "black", face = "plain") +
    font("xy.text", size = 16, color = "black", face = "plain") +

# Global "p-value"
# stat_compare_means(
#     # Method
#     # Options - t.test, wilcox.test, anova, kruskal.test
#     # Default - wilcox.test
#     method = "t.test",
#     
#     # If TRUE, hide ns symbol when displaying significance levels.
#     # hide.ns = TRUE,
# 
#     # Adjust position of "global p-value"
#     # Label
#     # - p: the p-value
#     # - p.format: the formatted p-value
#     # - p.signif: the significance level.
#     # Options - p.signif, ..p.signif.., p.format, ..p.format.., p, ..p..
#     # label = "..p.format..", 
#     # Custimze the "display combination"
#     # ..method..
#     aes(label = paste0(..method.., " p = ", format(p.format, digits = 3, nsmall = 2, scientific = TRUE))),
#     size = 4,
#     label.x = 1, label.y = 1.3 # x-y coordinates
# ) +

# "Pairwise Comparisons"
stat_compare_means(
    method = "t.test",
    
    # Add comparisons
    comparisons = p_value_comparisons,
    
    # 
    label = "p.signif",
    # label = "..p.signif..",
    size = 4,
    # "Y-position", use "list" to specify it for "EACH" comparison. 
    # label.y = c(1.1, 1.2, 1.3) 
)   
# "Pairwise Comparisons against reference"
# stat_compare_means(
#     # Define "reference"
#     # Use ".all." if doing "pairwise comparison" against "all"
#     ref.group = "I",
#     
#     # 
#     label = "p.signif",
#     # "Y-position", use "list" to specify it for "EACH" comparison. 
#     # label.y = c(1.1, 1.2, 1.3) 
# )

# Show in Notebook
boxplot.mut_type

# Export to file
ggarrange(boxplot.mut_type, ncol = 1) %>%
  ggexport(
      # PNG
      # res = 300,
      # width = 2000,
      # height = 2000,
      
      # 
      filename = GetoptLong::qq("boxplot-@{params$dataset_codename_str}-@{feature.name}.pdf")
      )

```


## `mut_ref_nt`

- Remove rows with "empty value"

```{r BoxPlot - mut_ref_nt, echo=FALSE, fig.width=6, fig.height=6}

# Feature Name
feature.name = 'mut_ref_nt'
feature.label = 'mut_ref_nt'

# Build "temp" dataset for plot
dataset.filtered = select(dataset, c('rna_id', 'editing_value', feature.name))
dataset.filtered = dataset.filtered[ !dataset.filtered[ , feature.name] %in% c('') , ]

#  For "Pairwise Comparisons"
p_value_comparisons = list( 
    c("A", "G"), 
    c("A", "C"), 
    c("A", "U")
)

wuplot_boxplot(
    dataset = dataset.filtered, 
    xcol = feature.name,
    ycol = 'editing_value', 
    boxplot_options = list(
        xlab = feature.label,
        ylab = "Editing Level",
        legend.title = feature.label
    ),
    fonts = list(
        xlab = list(size = 20),
        ylab = list(size = 20),
        xy.text = list(size = 16)
    ),
    compare_means = list(
        comparisons = p_value_comparisons
    ), 
    exports = list(
          # PNG
          # res = 300,
          # width = 2000,
          # height = 2000,
          
          # 
          filename = GetoptLong::qq("boxplot-@{params$dataset_codename_str}-@{feature.name}.pdf")
    )
)
```


## `mut_ref_struct`

- Remove rows with "empty value"
- Remove rows with "M" since it is too few....

```{r BoxPlot - mut_ref_struct, echo=FALSE, fig.width=6, fig.height=6}

# Feature Name
feature.name = 'mut_ref_struct'
feature.label = 'mut_ref_struct'

# Build "temp" dataset for plot
dataset.filtered = select(dataset, c('rna_id', 'editing_value', feature.name))
dataset.filtered = dataset.filtered[ !dataset.filtered[ , feature.name] %in% c('') , ]

#  For "Pairwise Comparisons"
p_value_comparisons = list( 
    c("S", "B"), 
    c("S", "I")
)

# Box Plot
wuplot_boxplot(
    dataset = dataset.filtered, 
    xcol = feature.name,
    ycol = 'editing_value', 
    boxplot_options = list(
        xlab = feature.label,
        ylab = "Editing Level",
        legend.title = feature.label
    ),
    fonts = list(
        xlab = list(size = 20),
        ylab = list(size = 20),
        xy.text = list(size = 16)
    ),
    compare_means = list(
        comparisons = p_value_comparisons
    ), 
    exports = list(
          # PNG
          # res = 300,
          # width = 2000,
          # height = 2000,
          
          # 
          filename = GetoptLong::qq("boxplot-@{params$dataset_codename_str}-@{feature.name}.pdf")
    )
)

```


## `mut_prev_struct`

- Remove rows with "empty value"
- Remove rows with "M" since it is too few....

```{r BoxPlot - mut_prev_struct, echo=FALSE, fig.width=6, fig.height=6}

# Feature Name
feature.name = 'mut_prev_struct'
feature.label = 'mut_prev_struct'

# Build "temp" dataset for plot
dataset.filtered = select(dataset, c('rna_id', 'editing_value', feature.name))
dataset.filtered = dataset.filtered[ !dataset.filtered[ , feature.name] %in% c('', 'M') , ]

#  For "Pairwise Comparisons"
p_value_comparisons = list( 
    c("S", "B"), 
    c("S", "H"), 
    c("S", "I")
)

# Box Plot
wuplot_boxplot(
    dataset = dataset.filtered, 
    xcol = feature.name,
    ycol = 'editing_value', 
    boxplot_options = list(
        xlab = feature.label,
        ylab = "Editing Level",
        legend.title = feature.label
    ),
    fonts = list(
        xlab = list(size = 20),
        ylab = list(size = 20),
        xy.text = list(size = 16)
    ),
    compare_means = list(
        comparisons = p_value_comparisons
    ), 
    exports = list(
          # PNG
          # res = 300,
          # width = 2000,
          # height = 2000,
          
          # 
          filename = GetoptLong::qq("boxplot-@{params$dataset_codename_str}-@{feature.name}.pdf")
    )
)

```


## `mut_next_struct`

- Remove rows with "empty value"
- Remove rows with "M" since it is too few....

```{r BoxPlot - mut_next_struct, echo=FALSE, fig.width=6, fig.height=6}

# Feature Name
feature.name = 'mut_next_struct'
feature.label = 'mut_next_struct'

# Build "temp" dataset for plot
dataset.filtered = select(dataset, c('rna_id', 'editing_value', feature.name))
dataset.filtered = dataset.filtered[ !dataset.filtered[ , feature.name] %in% c('', 'M') , ]

#  For "Pairwise Comparisons"
p_value_comparisons = list( 
    c("S", "B"), 
    c("S", "H"), 
    c("S", "I")
)

# Box Plot
wuplot_boxplot(
    dataset = dataset.filtered, 
    xcol = feature.name,
    ycol = 'editing_value', 
    boxplot_options = list(
        xlab = feature.label,
        ylab = "Editing Level",
        legend.title = feature.label
    ),
    fonts = list(
        xlab = list(size = 20),
        ylab = list(size = 20),
        xy.text = list(size = 16)
    ),
    compare_means = list(
        comparisons = p_value_comparisons
    ), 
    exports = list(
          # PNG
          # res = 300,
          # width = 2000,
          # height = 2000,
          
          # 
          filename = GetoptLong::qq("boxplot-@{params$dataset_codename_str}-@{feature.name}.pdf")
    )
)

```


## `site_struct`

- Remove rows with "empty value"

```{r BoxPlot - site_struct, echo=FALSE, fig.width=6, fig.height=6}

# Feature Name
feature.name = 'site_struct'
feature.label = 'site_struct'

# Build "temp" dataset for plot
dataset.filtered = select(dataset, c('rna_id', 'editing_value', feature.name))
dataset.filtered = dataset.filtered[ !dataset.filtered[ , feature.name] %in% c('') , ]

#  For "Pairwise Comparisons"
p_value_comparisons = list( 
    c("S", "B"), 
    c("S", "I")
)

# Box Plot
wuplot_boxplot(
    dataset = dataset.filtered, 
    xcol = feature.name,
    ycol = 'editing_value', 
    boxplot_options = list(
        xlab = feature.label,
        ylab = "Editing Level",
        legend.title = feature.label
    ),
    fonts = list(
        xlab = list(size = 20),
        ylab = list(size = 20),
        xy.text = list(size = 16)
    ),
    compare_means = list(
        comparisons = p_value_comparisons
    ), 
    exports = list(
          # PNG
          # res = 300,
          # width = 2000,
          # height = 2000,
          
          # 
          filename = GetoptLong::qq("boxplot-@{params$dataset_codename_str}-@{feature.name}.pdf")
    )
)

```

## `site_prev_nt`

- Remove rows with "empty value"

```{r BoxPlot - site_prev_nt, echo=FALSE, fig.width=6, fig.height=6}

# Feature Name
feature.name = 'site_prev_nt'
feature.label = 'site_prev_nt'

# Build "temp" dataset for plot
dataset.filtered = select(dataset, c('rna_id', 'editing_value', feature.name))
dataset.filtered = dataset.filtered[ !dataset.filtered[ , feature.name] %in% c('') , ]

#  For "Pairwise Comparisons"
p_value_comparisons = list( 
    c("A", "U")
)

# Box Plot
wuplot_boxplot(
    dataset = dataset.filtered, 
    xcol = feature.name,
    ycol = 'editing_value', 
    boxplot_options = list(
        xlab = feature.label,
        ylab = "Editing Level",
        legend.title = feature.label
    ),
    fonts = list(
        xlab = list(size = 20),
        ylab = list(size = 20),
        xy.text = list(size = 16)
    ),
    compare_means = list(
        comparisons = p_value_comparisons
    ), 
    exports = list(
          # PNG
          # res = 300,
          # width = 2000,
          # height = 2000,
        
          # 
          filename = GetoptLong::qq("boxplot-@{params$dataset_codename_str}-@{feature.name}.pdf")
    )
)

```


## `site_next_nt`

- Remove rows with "empty value"

```{r BoxPlot - site_next_nt, echo=FALSE, fig.width=6, fig.height=6}

# Feature Name
feature.name = 'site_next_nt'
feature.label = 'site_next_nt'

# Build "temp" dataset for plot
dataset.filtered = select(dataset, c('rna_id', 'editing_value', feature.name))
dataset.filtered = dataset.filtered[ !dataset.filtered[ , feature.name] %in% c('') , ]

#  For "Pairwise Comparisons"
p_value_comparisons = list( 
    c("A", "U")
)

# Box Plot
wuplot_boxplot(
    dataset = dataset.filtered, 
    xcol = feature.name,
    ycol = 'editing_value', 
    boxplot_options = list(
        xlab = feature.label,
        ylab = "Editing Level",
        legend.title = feature.label
    ),
    fonts = list(
        xlab = list(size = 20),
        ylab = list(size = 20),
        xy.text = list(size = 16)
    ),
    compare_means = list(
        comparisons = p_value_comparisons
    ), 
    exports = list(
          # PNG
          # res = 300,
          # width = 2000,
          # height = 2000,
          
          # 
          filename = GetoptLong::qq("boxplot-@{params$dataset_codename_str}-@{feature.name}.pdf")
    )
)

```


## `site_1_1`

- Remove rows with "empty value"

```{r BoxPlot - site_1_1, echo=FALSE, fig.width=6, fig.height=6}

# Feature Name
feature.name = 'site_1_1'
feature.label = 'site_1_1'

# Build "temp" dataset for plot
dataset.filtered = select(dataset, c('rna_id', 'editing_value', feature.name))
# dataset.filtered = dataset.filtered[ !dataset.filtered[ , feature.name] %in% c('') , ]

# Use "Others" to replace "empty" value in "feature" column
levels(dataset.filtered[, feature.name]) = c(levels(dataset.filtered[, feature.name]), 'Others')
dataset.filtered[, feature.name][ dataset.filtered[ , feature.name] %in% c('') ] <- 'Others'

#  For "Pairwise Comparisons"
p_value_comparisons = list( 
    c("A:C", "Others")
)

# Box Plot
wuplot_boxplot(
    dataset = dataset.filtered, 
    xcol = feature.name,
    ycol = 'editing_value', 
    boxplot_options = list(
        xlab = feature.label,
        ylab = "Editing Level",
        legend.title = feature.label
    ),
    fonts = list(
        xlab = list(size = 20),
        ylab = list(size = 20),
        xy.text = list(size = 16)
    ),
    compare_means = list(
        comparisons = p_value_comparisons
    ), 
    exports = list(
          # PNG
          # res = 300,
          # width = 2000,
          # height = 2000,
        
          # 
          filename = GetoptLong::qq("boxplot-@{params$dataset_codename_str}-@{feature.name}.pdf")
    )
)

```


## `num_mutations`

- Remove rows whose "num_mutations" is "0". 
- Group "num_mutations" into three groups - "1", "2", ">2"

```{r BoxPlot - num_mutations, echo=FALSE, fig.width=6, fig.height=6}

# Feature Name
feature.name = 'num_mutations'
feature.label = 'num_mutations'

# Build "temp" dataset for plot
dataset.filtered = select(dataset, c('rna_id', 'editing_value', feature.name))
dataset.filtered = dataset.filtered[ dataset.filtered[ , feature.name] > 0 , ]

# Transform
dataset.filtered$num_mutations_orig = dataset.filtered$num_mutations
transformFunc <- function(row){
    num_mutations <- row[4]
    
    if (num_mutations == 1) {
        value = "1"
    } else if (num_mutations == 2) {
        value = "2"
    } else {
        value = ">2"
    }

    return(value)
}
dataset.filtered$num_mutations <- apply(dataset.filtered, 1, transformFunc)

#  For "Pairwise Comparisons"
p_value_comparisons = list( 
    c("1", "2"),
    c("1", ">2"),
    c("2", ">2")
)

# Box Plot
wuplot_boxplot(
    dataset = dataset.filtered, 
    xcol = feature.name,
    ycol = 'editing_value', 
    boxplot_options = list(
        xlab = feature.label,
        ylab = "Editing Level",
        legend.title = feature.label
    ),
    fonts = list(
        xlab = list(size = 20),
        ylab = list(size = 20),
        xy.text = list(size = 16)
    ),
    compare_means = list(
        comparisons = p_value_comparisons
    ), 
    exports = list(
          # PNG
          # res = 300,
          # width = 2000,
          # height = 2000,

          # 
          filename = GetoptLong::qq("boxplot-@{params$dataset_codename_str}-@{feature.name}.pdf")
    )
)

```



## `free_energy`

- Group "editing_value" based on the quantitle 

```{r BoxPlot - free_energy, echo=FALSE, message=FALSE, fig.width=6, fig.height=6}

# Feature Name
feature.name = 'free_energy'
feature.label = 'free_energy'

# Build "temp" dataset for plot
dataset.filtered = select(dataset, c('rna_id', 'editing_value', feature.name))
dataset.filtered = dataset.filtered[ is.na(dataset.filtered[ , feature.name]) == FALSE , ]

# General Explore

# Editing Level Dist
# plot <- ggplot(dataset.filtered, 
#                aes(x = editing_value))
# plot + geom_histogram(
#     binwidth = 0.02
# )

# Editing Level Quantile
# dens <- density(dataset.filtered$editing_value)
# df <- data.frame(x = dens$x, y = dens$y)
# probs <- c(0, 0.25, 0.5, 0.75, 1)
# quantiles <- quantile(dataset.filtered$editing_value, prob = probs)
# df$quant <- factor(findInterval(df$x, quantiles))
# ggplot(df, aes(x,y)) + geom_line() + geom_ribbon(aes(ymin=0, ymax=y, fill=quant)) + scale_x_continuous(breaks=quantiles) + scale_fill_brewer(guide="none")


# Transform
# Use "quantitle" to split "editing level"
dataset.filtered$editing_value_orig = dataset.filtered$editing_value
probs <- seq(0, 1, by = 0.25)
quantiles <- quantile(dataset.filtered$editing_value, prob = probs)
dataset.filtered$editing_value <- cut(dataset.filtered$editing_value, 
           # quantiles,
           breaks = quantiles,
           labels = c("0-25", "25-50", "50-75", "75-100"),
           include.lowest = TRUE)

# 

#  For "Pairwise Comparisons"
p_value_comparisons = list(
    c("0-25", "25-50"),
    c("0-25", "50-75"),
    c("0-25", "75-100"),
    c("25-50", "50-75"),
    c("25-50", "75-100"),
    c("50-75", "75-100")
)

# Box Plot
wuplot_boxplot(
    dataset = dataset.filtered, 
    ycol = feature.name,
    xcol = 'editing_value', 
    boxplot_options = list(
        ylab = feature.label,
        xlab = "Editing Level",
        legend.title = "editing_level",
        
        # Remove "jitter" and add "error bar"
        bxp.errorbar = TRUE,
        add = FALSE
    ),
    fonts = list(
        xlab = list(size = 20),
        ylab = list(size = 20),
        xy.text = list(size = 16)
    ),
    compare_means = list(
        comparisons = p_value_comparisons
    ), 
    exports = list(
          # PNG
          # res = 300,
          # width = 2000,
          # height = 2000,
          
          # 
          filename = GetoptLong::qq("boxplot-@{params$dataset_codename_str}-@{feature.name}.pdf")
    )
)

# ==========================
# Focused Version
dataset.filtered = dataset.filtered[ dataset.filtered[ , 'editing_value'] %in% c("0-25", "75-100") , ]
p_value_comparisons = list(
    c("0-25", "75-100")
)
wuplot_boxplot(
    dataset = dataset.filtered, 
    ycol = feature.name,
    xcol = 'editing_value', 
    boxplot_options = list(
        ylab = feature.label,
        xlab = "Editing Level",
        legend.title = "editing_level",
        
        # Remove "jitter" and add "error bar"
        bxp.errorbar = TRUE,
        add = FALSE
    ),
    fonts = list(
        xlab = list(size = 20),
        ylab = list(size = 20),
        xy.text = list(size = 16)
    ),
    compare_means = list(
        comparisons = p_value_comparisons
    ), 
    exports = list(
          # 
          width = 4,  # 72 DPI
          filename = GetoptLong::qq("boxplot-@{params$dataset_codename_str}-@{feature.name}-focused.pdf")
    )
)

```


## `all_stem_length`

- Group "editing_value" based on the quantitle 

```{r BoxPlot - all_stem_length, echo=FALSE, fig.width=6, fig.height=6}

# Feature Name
feature.name = 'all_stem_length'
feature.label = 'all_stem_length'

# Build "temp" dataset for plot
dataset.filtered = select(dataset, c('rna_id', 'editing_value', feature.name))
dataset.filtered = dataset.filtered[ is.na(dataset.filtered[ , feature.name]) == FALSE , ]

# Transform
# Use "quantitle" to split "editing level"
dataset.filtered$editing_value_orig = dataset.filtered$editing_value
probs <- seq(0, 1, by = 0.25)
quantiles <- quantile(dataset.filtered$editing_value, prob = probs)
dataset.filtered$editing_value <- cut(dataset.filtered$editing_value, 
           # quantiles,
           breaks = quantiles,
           labels = c("0-25", "25-50", "50-75", "75-100"),
           include.lowest = TRUE)

#  For "Pairwise Comparisons"
p_value_comparisons = list(
    c("0-25", "25-50"),
    c("0-25", "50-75"),
    c("0-25", "75-100"),
    c("25-50", "50-75"),
    c("25-50", "75-100"),
    c("50-75", "75-100")
)


# ==========================
# BoxPlot - vs "editing_level"
wuplot_boxplot(
    dataset = dataset.filtered, 
    ycol = feature.name,
    xcol = 'editing_value', 
    boxplot_options = list(
        ylab = feature.label,
        xlab = "Editing Level",
        legend.title = "editing_level",
        
        # Remove "jitter" and add "error bar"
        bxp.errorbar = TRUE,
        add = FALSE
    ),
    fonts = list(
        xlab = list(size = 20),
        ylab = list(size = 20),
        xy.text = list(size = 16)
    ),
    compare_means = list(
        comparisons = p_value_comparisons
    ), 
    exports = list(
          # PNG
          # res = 300,
          # width = 2000,
          # height = 2000,
          
          # 
          filename = GetoptLong::qq("boxplot-@{params$dataset_codename_str}-@{feature.name}.pdf")
    )
)

# ==========================
# BoxPlot - "editing_level" vs 
wuplot_boxplot(
    dataset = dataset.filtered, 
    xcol = feature.name,
    ycol = 'editing_value_orig', 
    boxplot_options = list(
        xlab = feature.label,
        ylab = "Editing Level",
        legend.title = feature.label,
        
        # Remove "jitter" and add "error bar"
        bxp.errorbar = TRUE
    ),
    fonts = list(
        xlab = list(size = 20),
        ylab = list(size = 20),
        xy.text = list(size = 16)
    ),
    compare_means = list(
        comparisons = list()
    ), 
    exports = list(
          # PNG
          # res = 300,
          # width = 2000,
          # height = 2000,
          
          # 
          filename = GetoptLong::qq("boxplot-@{params$dataset_codename_str}-@{feature.name}-reversed.pdf")
    )
)

```

```{r BoxPlot - all_stem_length - 2, echo=FALSE, fig.width=3.5, fig.height=6}

# ==========================
# Focused Version - "editing_level" sliced
dataset.filtered = dataset.filtered[ dataset.filtered[ , 'editing_value'] %in% c("0-25", "75-100") , ]
p_value_comparisons = list(
    c("0-25", "75-100")
)
wuplot_boxplot(
    dataset = dataset.filtered, 
    ycol = feature.name,
    xcol = 'editing_value', 
    boxplot_options = list(
        ylab = feature.label,
        xlab = "Editing Level",
        legend.title = "editing_level",
        
        # Remove "jitter" and add "error bar"
        bxp.errorbar = TRUE,
        add = FALSE
    ),
    fonts = list(
        xlab = list(size = 20),
        ylab = list(size = 20),
        xy.text = list(size = 16)
    ),
    compare_means = list(
        comparisons = p_value_comparisons
    ), 
    exports = list(
          # 
          width = 4,  # 72 DPI
          filename = GetoptLong::qq("boxplot-@{params$dataset_codename_str}-@{feature.name}-focused.pdf")
    )
)

```

```{r ScatterPlot - all_stem_length, echo=FALSE, fig.width=6, fig.height=6}

scatterplot.all_stem_length <- ggscatter(
          dataset.filtered,
          x = feature.name, 
          y = "editing_value_orig",
          
          xlab = feature.label,
          ylab = "Editing Level", 
          
          conf.int = TRUE,                                  # Add confidence interval
          
          add = "reg.line",                                 # Add regression line
          add.params = list(
              color = "#3a7ebf" 
              # fill = '#eeeeee', # "lightgray",
              # linetype = "dashed"
              ),
          
          title = feature.name,
          color = '#545960'
          
          #
          # fullrange = TRUE,                         # Extending the regression line
          # rug = TRUE,                                # Add marginal rug
          
          ) +
    stat_cor(method = "pearson", 
             aes(label = paste(..rr.label.., ..p.label.., sep = "~`,`~")), # Use R^2
             label.x = 40.005, label.y = 1.02) +  # Add correlation coefficient
    
    # 
    # border("black") +
    xlim(40, 46) + 
    ylim(-0.1, 1.05) + 
    
    # Change the appearance of legend title and texts
    font("legend.title", size = 10, color = "black", face = "plain") +
    font("legend.text", size = 12, color = "black", face = "plain") +
    
    # Axis
    font("xlab", size = 20, color = "black", face = "plain") +
    font("ylab", size = 20, color = "black", face = "plain") +
    font("x.text", size = 16, color = "black", face = "plain") +
    font("y.text", size = 16, color = "black", face = "plain")


scatterplot.all_stem_length

# Export to file
ggarrange(scatterplot.all_stem_length, ncol = 1) %>%
  ggexport(
      # 
      # res = 300,
      # width = 2000,
      # height = 2000,
      # filename = GetoptLong::qq("scatter_plot--@{params$dataset_codename_str}-@{feature.name}.pdf")
      
      width = 6,
      height = 6,
      filename = GetoptLong::qq("scatter_plot--@{params$dataset_codename_str}-@{feature.name}.pdf")
      )


```

## `site_length`

- Group "editing_value" based on the quantitle 

```{r BoxPlot - site_length, echo=FALSE, fig.width=6, fig.height=6}

# Feature Name
feature.name = 'site_length'
feature.label = 'site_length'

# Build "temp" dataset for plot
dataset.filtered = select(dataset, c('rna_id', 'editing_value', feature.name))
dataset.filtered = dataset.filtered[ is.na(dataset.filtered[ , feature.name]) == FALSE , ]

# Transform
# Use "quantitle" to split "editing level"
dataset.filtered$editing_value_orig = dataset.filtered$editing_value
probs <- seq(0, 1, by = 0.25)
quantiles <- quantile(dataset.filtered$editing_value, prob = probs)
dataset.filtered$editing_value <- cut(dataset.filtered$editing_value, 
           # quantiles,
           breaks = quantiles,
           labels = c("0-25", "25-50", "50-75", "75-100"),
           include.lowest = TRUE)

#  For "Pairwise Comparisons"
p_value_comparisons = list(
    # c("0-25", "25-50"),
    # c("0-25", "50-75"),
    c("0-25", "75-100")
    # c("25-50", "50-75"),
    # c("25-50", "75-100"),
    # c("50-75", "75-100")
)

# Plot
wuplot_boxplot(
    dataset = dataset.filtered, 
    xcol = 'editing_value', 
    ycol = feature.name,
    boxplot_options = list(
        title = FALSE,
        xlab = "Editing Level",
        ylab = feature.label,
        legend.title = 'editing_level',
        
        # Remove "jitter" and add "error bar"
        bxp.errorbar = TRUE,
        add = FALSE
    ),
    fonts = list(
        xlab = list(size = 20),
        ylab = list(size = 20),
        xy.text = list(size = 16)
    ),
    compare_means = list(
        comparisons = p_value_comparisons
    ), 
    exports = list(
          # PNG
          # res = 300,
          # width = 2000,
          # height = 2000,

          # 
          filename = GetoptLong::qq("boxplot-@{params$dataset_codename_str}-@{feature.name}.pdf")
    )
)

# ==========================
# BoxPlot - "editing_level" vs 
wuplot_boxplot(
    dataset = dataset.filtered, 
    xcol = feature.name,
    ycol = 'editing_value_orig', 
    boxplot_options = list(
        xlab = feature.label,
        ylab = "Editing Level",
        legend.title = feature.label,
        
        # Remove "jitter" and add "error bar"
        bxp.errorbar = TRUE
    ),
    fonts = list(
        xlab = list(size = 20),
        ylab = list(size = 20),
        xy.text = list(size = 16)
    ),
    compare_means = list(
        comparisons = list()
    ), 
    exports = list(
          # PNG
          # res = 300,
          # width = 2000,
          # height = 2000,
          
          # 
          filename = GetoptLong::qq("boxplot-@{params$dataset_codename_str}-@{feature.name}-reversed.pdf")
    )
)

```

```{r BoxPlot - site_length - 2, echo=FALSE, fig.width=3.5, fig.height=6}

# ==========================
# Focused Version - "editing_level" sliced
dataset.filtered = dataset.filtered[ dataset.filtered[ , 'editing_value'] %in% c("0-25", "75-100") , ]
p_value_comparisons = list(
    c("0-25", "75-100")
)
wuplot_boxplot(
    dataset = dataset.filtered, 
    ycol = feature.name,
    xcol = 'editing_value', 
    boxplot_options = list(
        ylab = feature.label,
        xlab = "Editing Level",
        legend.title = "editing_level",
        
        # Remove "jitter" and add "error bar"
        bxp.errorbar = TRUE,
        add = FALSE
    ),
    fonts = list(
        xlab = list(size = 20),
        ylab = list(size = 20),
        xy.text = list(size = 16)
    ),
    compare_means = list(
        comparisons = p_value_comparisons
    ), 
    exports = list(
          # 
          width = 4,  # 72 DPI
          filename = GetoptLong::qq("boxplot-@{params$dataset_codename_str}-@{feature.name}-focused.pdf")
    )
)

```


## `u_all_stem_length`

- Group "editing_value" based on the quantitle 

```{r BoxPlot - u_all_stem_length, echo=FALSE, fig.width=6, fig.height=6}

# Feature Name
feature.name = 'u_all_stem_length'
feature.label = 'u_all_stem_length'

# Build "temp" dataset for plot
dataset.filtered = select(dataset, c('rna_id', 'editing_value', feature.name))
dataset.filtered = dataset.filtered[ is.na(dataset.filtered[ , feature.name]) == FALSE , ]

# Transform
# Use "quantitle" to split "editing level"
dataset.filtered$editing_value_orig = dataset.filtered$editing_value
probs <- seq(0, 1, by = 0.25)
quantiles <- quantile(dataset.filtered$editing_value, prob = probs)
dataset.filtered$editing_value <- cut(dataset.filtered$editing_value, 
           # quantiles,
           breaks = quantiles,
           labels = c("0-25", "25-50", "50-75", "75-100"),
           include.lowest = TRUE)

#  For "Pairwise Comparisons"
p_value_comparisons = list(
    c("0-25", "25-50"),
    c("0-25", "50-75"),
    c("0-25", "75-100"),
    c("25-50", "50-75"),
    c("25-50", "75-100"),
    c("50-75", "75-100")
)

# Plot
wuplot_boxplot(
    dataset = dataset.filtered, 
    xcol = 'editing_value', 
    ycol = feature.name,
    boxplot_options = list(
        title = FALSE,
        xlab = "Editing Level",
        ylab = feature.label,
        legend.title = 'editing_level',
        
        # Remove "jitter" and add "error bar"
        bxp.errorbar = TRUE,
        add = FALSE
    ),
    fonts = list(
        xlab = list(size = 20),
        ylab = list(size = 20),
        xy.text = list(size = 16)
    ),
    compare_means = list(
        comparisons = p_value_comparisons
    ), 
    exports = list(
          # PNG
          # res = 300,
          # width = 2000,
          # height = 2000,
          
          # 
          filename = GetoptLong::qq("boxplot-@{params$dataset_codename_str}-@{feature.name}.pdf")
    )
)

# ==========================
# BoxPlot - "editing_level" vs 
wuplot_boxplot(
    dataset = dataset.filtered, 
    xcol = feature.name,
    ycol = 'editing_value_orig', 
    boxplot_options = list(
        xlab = feature.label,
        ylab = "Editing Level",
        legend.title = feature.label,
        
        # Remove "jitter" and add "error bar"
        bxp.errorbar = TRUE
    ),
    fonts = list(
        xlab = list(size = 20),
        ylab = list(size = 20),
        xy.text = list(size = 16)
    ),
    compare_means = list(
        comparisons = list()
    ), 
    exports = list(
          # PNG
          # res = 300,
          # width = 2000,
          # height = 2000,
          
          # 
          filename = GetoptLong::qq("boxplot-@{params$dataset_codename_str}-@{feature.name}-reversed.pdf")
    )
)

```

```{r BoxPlot - u_all_stem_length - 2, echo=FALSE, fig.width=3.5, fig.height=6}

# ==========================
# Focused Version - "editing_level" sliced
dataset.filtered = dataset.filtered[ dataset.filtered[ , 'editing_value'] %in% c("0-25", "75-100") , ]
p_value_comparisons = list(
    c("0-25", "75-100")
)
wuplot_boxplot(
    dataset = dataset.filtered, 
    ycol = feature.name,
    xcol = 'editing_value', 
    boxplot_options = list(
        ylab = feature.label,
        xlab = "Editing Level",
        legend.title = "editing_level",
        
        # Remove "jitter" and add "error bar"
        bxp.errorbar = TRUE,
        add = FALSE
    ),
    fonts = list(
        xlab = list(size = 20),
        ylab = list(size = 20),
        xy.text = list(size = 16)
    ),
    compare_means = list(
        comparisons = p_value_comparisons
    ), 
    exports = list(
          # 
          width = 4,  # 72 DPI
          filename = GetoptLong::qq("boxplot-@{params$dataset_codename_str}-@{feature.name}-focused.pdf")
    )
)

```

```{r ScatterPlot - u_all_stem_length, echo=FALSE, fig.width=6, fig.height=6}

scatterplot.u_all_stem_length <- ggscatter(
          dataset.filtered,
          x = feature.name, 
          y = "editing_value_orig",
          
          xlab = feature.label,
          ylab = "Editing Level", 
          
          conf.int = TRUE,                                  # Add confidence interval
          
          add = "reg.line",                                 # Add regression line
          add.params = list(
              color = "#3a7ebf" 
              # fill = '#eeeeee', # "lightgray",
              # linetype = "dashed"
              ),
          
          title = feature.name,
          color = '#545960'
          
          #
          # fullrange = TRUE,                         # Extending the regression line
          # rug = TRUE,                                # Add marginal rug
          
          ) +
    stat_cor(method = "pearson", 
             aes(label = paste(..rr.label.., ..p.label.., sep = "~`,`~")), # Use R^2
             label.x = 7.005, label.y = 1.02) +  # Add correlation coefficient
    
    # 
    # border("black") +
    xlim(7, 14) + 
    ylim(-0.1, 1.05) + 
    
    # Change the appearance of legend title and texts
    font("legend.title", size = 10, color = "black", face = "plain") +
    font("legend.text", size = 12, color = "black", face = "plain") +
    
    # Axis
    font("xlab", size = 20, color = "black", face = "plain") +
    font("ylab", size = 20, color = "black", face = "plain") +
    font("x.text", size = 16, color = "black", face = "plain") +
    font("y.text", size = 16, color = "black", face = "plain")


scatterplot.u_all_stem_length

# Export to file
ggarrange(scatterplot.u_all_stem_length, ncol = 1) %>%
  ggexport(
      # 
      # res = 300,
      # width = 2000,
      # height = 2000,
      # filename = GetoptLong::qq("scatter_plot--@{params$dataset_codename_str}-@{feature.name}.pdf")
      
      width = 6,
      height = 6,
      filename = GetoptLong::qq("scatter_plot--@{params$dataset_codename_str}-@{feature.name}.pdf")
      )


```

## `u_hairpin_length`

- Group "editing_value" based on the quantitle 

```{r BoxPlot - u_hairpin_length, echo=FALSE, fig.width=6, fig.height=6}

# Feature Name
feature.name = 'u_hairpin_length'
feature.label = 'u_hairpin_length'

# Build "temp" dataset for plot
dataset.filtered = select(dataset, c('rna_id', 'editing_value', feature.name))
dataset.filtered = dataset.filtered[ is.na(dataset.filtered[ , feature.name]) == FALSE , ]

# Transform
# Use "quantitle" to split "editing level"
dataset.filtered$editing_value_orig = dataset.filtered$editing_value
probs <- seq(0, 1, by = 0.25)
quantiles <- quantile(dataset.filtered$editing_value, prob = probs)
dataset.filtered$editing_value <- cut(dataset.filtered$editing_value, 
           # quantiles,
           breaks = quantiles,
           labels = c("0-25", "25-50", "50-75", "75-100"),
           include.lowest = TRUE)

#  For "Pairwise Comparisons"
p_value_comparisons = list(
    c("0-25", "25-50"),
    c("0-25", "50-75"),
    c("0-25", "75-100"),
    c("25-50", "50-75"),
    c("25-50", "75-100"),
    c("50-75", "75-100")
)

# Plot
wuplot_boxplot(
    dataset = dataset.filtered, 
    xcol = 'editing_value', 
    ycol = feature.name,
    boxplot_options = list(
        title = FALSE,
        xlab = "Editing Level",
        ylab = feature.label,
        legend.title = 'editing_level',
        
        # Remove "jitter" and add "error bar"
        bxp.errorbar = TRUE,
        add = FALSE
    ),
    fonts = list(
        xlab = list(size = 20),
        ylab = list(size = 20),
        xy.text = list(size = 16)
    ),
    compare_means = list(
        comparisons = p_value_comparisons
    ), 
    exports = list(
        filename = GetoptLong::qq("boxplot-@{params$dataset_codename_str}-@{feature.name}.pdf")
    )
)

# ==========================
# BoxPlot - "editing_level" vs 
wuplot_boxplot(
    dataset = dataset.filtered, 
    xcol = feature.name,
    ycol = 'editing_value_orig', 
    boxplot_options = list(
        xlab = feature.label,
        ylab = "Editing Level",
        legend.title = feature.label,
        
        # Remove "jitter" and add "error bar"
        bxp.errorbar = TRUE
    ),
    fonts = list(
        xlab = list(size = 20),
        ylab = list(size = 20),
        xy.text = list(size = 16)
    ),
    compare_means = list(
        comparisons = list()
    ), 
    exports = list(
        filename = GetoptLong::qq("boxplot-@{params$dataset_codename_str}-@{feature.name}-reversed.pdf")
    )
)

```

```{r BoxPlot - u_hairpin_length - 2, echo=FALSE, fig.width=3.5, fig.height=6}

# ==========================
# Focused Version - "editing_level" sliced
dataset.filtered = dataset.filtered[ dataset.filtered[ , 'editing_value'] %in% c("0-25", "75-100") , ]
p_value_comparisons = list(
    c("0-25", "75-100")
)
wuplot_boxplot(
    dataset = dataset.filtered, 
    ycol = feature.name,
    xcol = 'editing_value', 
    boxplot_options = list(
        ylab = feature.label,
        xlab = "Editing Level",
        legend.title = "editing_level",
        
        # Remove "jitter" and add "error bar"
        bxp.errorbar = TRUE,
        add = FALSE
    ),
    fonts = list(
        xlab = list(size = 20),
        ylab = list(size = 20),
        xy.text = list(size = 16)
    ),
    compare_means = list(
        comparisons = p_value_comparisons
    ), 
    exports = list(
        width = 4,  # 72 DPI
        filename = GetoptLong::qq("boxplot-@{params$dataset_codename_str}-@{feature.name}-focused.pdf")
    )
)

```


## `u1_length`

- Group "editing_value" based on the quantitle 

```{r BoxPlot - u1_length, echo=FALSE, fig.width=6, fig.height=6}

# Feature Name
feature.name = 'u1_length'
feature.label = 'u1_length'

# Build "temp" dataset for plot
dataset.filtered = select(dataset, c('rna_id', 'editing_value', feature.name))
dataset.filtered = dataset.filtered[ is.na(dataset.filtered[ , feature.name]) == FALSE , ]

# Transform
# Use "quantitle" to split "editing level"
dataset.filtered$editing_value_orig = dataset.filtered$editing_value
probs <- seq(0, 1, by = 0.25)
quantiles <- quantile(dataset.filtered$editing_value, prob = probs)
dataset.filtered$editing_value <- cut(dataset.filtered$editing_value, 
           # quantiles,
           breaks = quantiles,
           labels = c("0-25", "25-50", "50-75", "75-100"),
           include.lowest = TRUE)

#  For "Pairwise Comparisons"
p_value_comparisons = list(
    c("0-25", "25-50"),
    c("0-25", "50-75"),
    c("0-25", "75-100"),
    c("25-50", "50-75"),
    c("25-50", "75-100"),
    c("50-75", "75-100")
)

# Plot
wuplot_boxplot(
    dataset = dataset.filtered, 
    xcol = 'editing_value', 
    ycol = feature.name,
    boxplot_options = list(
        title = FALSE,
        xlab = "Editing Level",
        ylab = feature.label,
        legend.title = 'editing_level',
        
        # Remove "jitter" and add "error bar"
        bxp.errorbar = TRUE,
        add = FALSE
    ),
    fonts = list(
        xlab = list(size = 20),
        ylab = list(size = 20),
        xy.text = list(size = 16)
    ),
    compare_means = list(
        comparisons = p_value_comparisons
    ), 
    exports = list(
        filename = GetoptLong::qq("boxplot-@{params$dataset_codename_str}-@{feature.name}.pdf")
    )
)

# ==========================
# BoxPlot - "editing_level" vs 
wuplot_boxplot(
    dataset = dataset.filtered, 
    xcol = feature.name,
    ycol = 'editing_value_orig', 
    boxplot_options = list(
        xlab = feature.label,
        ylab = "Editing Level",
        legend.title = feature.label,
        
        # Remove "jitter" and add "error bar"
        bxp.errorbar = TRUE
    ),
    fonts = list(
        xlab = list(size = 20),
        ylab = list(size = 20),
        xy.text = list(size = 16)
    ),
    compare_means = list(
        comparisons = list()
    ), 
    exports = list(
        filename = GetoptLong::qq("boxplot-@{params$dataset_codename_str}-@{feature.name}-reversed.pdf")
    )
)

```

```{r BoxPlot - u1_length - 2, echo=FALSE, fig.width=3.5, fig.height=6}

# ==========================
# Focused Version - "editing_level" sliced
dataset.filtered = dataset.filtered[ dataset.filtered[ , 'editing_value'] %in% c("0-25", "75-100") , ]
p_value_comparisons = list(
    c("0-25", "75-100")
)
wuplot_boxplot(
    dataset = dataset.filtered, 
    ycol = feature.name,
    xcol = 'editing_value', 
    boxplot_options = list(
        ylab = feature.label,
        xlab = "Editing Level",
        legend.title = "editing_level",
        
        # Remove "jitter" and add "error bar"
        bxp.errorbar = TRUE,
        add = FALSE
    ),
    fonts = list(
        xlab = list(size = 20),
        ylab = list(size = 20),
        xy.text = list(size = 16)
    ),
    compare_means = list(
        comparisons = p_value_comparisons
    ), 
    exports = list(
        width = 4,  # 72 DPI
        filename = GetoptLong::qq("boxplot-@{params$dataset_codename_str}-@{feature.name}-focused.pdf")
    )
)

```


## `d_all_stem_length`

- Group "editing_value" based on the quantitle 

```{r BoxPlot - d_all_stem_length, echo=FALSE, fig.width=6, fig.height=6}

# Feature Name
feature.name = 'd_all_stem_length'
feature.label = 'd_all_stem_length'

# Build "temp" dataset for plot
dataset.filtered = select(dataset, c('rna_id', 'editing_value', feature.name))
dataset.filtered = dataset.filtered[ is.na(dataset.filtered[ , feature.name]) == FALSE , ]

# Transform
# Use "quantitle" to split "editing level"
dataset.filtered$editing_value_orig = dataset.filtered$editing_value
probs <- seq(0, 1, by = 0.25)
quantiles <- quantile(dataset.filtered$editing_value, prob = probs)
dataset.filtered$editing_value <- cut(dataset.filtered$editing_value, 
           # quantiles,
           breaks = quantiles,
           labels = c("0-25", "25-50", "50-75", "75-100"),
           include.lowest = TRUE)

#  For "Pairwise Comparisons"
p_value_comparisons = list(
    c("0-25", "25-50"),
    c("0-25", "50-75"),
    c("0-25", "75-100"),
    c("25-50", "50-75"),
    c("25-50", "75-100"),
    c("50-75", "75-100")
)

# Plot
wuplot_boxplot(
    dataset = dataset.filtered, 
    xcol = 'editing_value', 
    ycol = feature.name,
    boxplot_options = list(
        title = FALSE,
        xlab = "Editing Level",
        ylab = feature.label,
        legend.title = 'editing_level',
        
        # Remove "jitter" and add "error bar"
        bxp.errorbar = TRUE,
        add = FALSE
    ),
    fonts = list(
        xlab = list(size = 20),
        ylab = list(size = 20),
        xy.text = list(size = 16)
    ),
    compare_means = list(
        comparisons = p_value_comparisons
    ), 
    exports = list(
        filename = GetoptLong::qq("boxplot-@{params$dataset_codename_str}-@{feature.name}.pdf")
    )
)

# ==========================
# BoxPlot - "editing_level" vs 
wuplot_boxplot(
    dataset = dataset.filtered, 
    xcol = feature.name,
    ycol = 'editing_value_orig', 
    boxplot_options = list(
        xlab = feature.label,
        ylab = "Editing Level",
        legend.title = feature.label,
        
        # Remove "jitter" and add "error bar"
        bxp.errorbar = TRUE
    ),
    fonts = list(
        xlab = list(size = 20),
        ylab = list(size = 20),
        xy.text = list(size = 16)
    ),
    compare_means = list(
        comparisons = list()
    ), 
    exports = list(
        filename = GetoptLong::qq("boxplot-@{params$dataset_codename_str}-@{feature.name}-reversed.pdf")
    )
)

```

```{r BoxPlot - d_all_stem_length - 2, echo=FALSE, fig.width=3.5, fig.height=6}

# ==========================
# Focused Version - "editing_level" sliced
dataset.filtered = dataset.filtered[ dataset.filtered[ , 'editing_value'] %in% c("0-25", "75-100") , ]
p_value_comparisons = list(
    c("0-25", "75-100")
)
wuplot_boxplot(
    dataset = dataset.filtered, 
    ycol = feature.name,
    xcol = 'editing_value', 
    boxplot_options = list(
        ylab = feature.label,
        xlab = "Editing Level",
        legend.title = "editing_level",
        
        # Remove "jitter" and add "error bar"
        bxp.errorbar = TRUE,
        add = FALSE
    ),
    fonts = list(
        xlab = list(size = 20),
        ylab = list(size = 20),
        xy.text = list(size = 16)
    ),
    compare_means = list(
        comparisons = p_value_comparisons
    ), 
    exports = list(
        width = 4,  # 72 DPI
        filename = GetoptLong::qq("boxplot-@{params$dataset_codename_str}-@{feature.name}-focused.pdf")
    )
)

```


## `d1_length`

- Group "editing_value" based on the quantitle 

```{r BoxPlot - d1_length, echo=FALSE, fig.width=6, fig.height=6}

# Feature Name
feature.name = 'd1_length'
feature.label = 'd1_length'

# Build "temp" dataset for plot
dataset.filtered = select(dataset, c('rna_id', 'editing_value', feature.name))
dataset.filtered = dataset.filtered[ is.na(dataset.filtered[ , feature.name]) == FALSE , ]

# Transform
# Use "quantitle" to split "editing level"
dataset.filtered$editing_value_orig = dataset.filtered$editing_value
probs <- seq(0, 1, by = 0.25)
quantiles <- quantile(dataset.filtered$editing_value, prob = probs)
dataset.filtered$editing_value <- cut(dataset.filtered$editing_value, 
           # quantiles,
           breaks = quantiles,
           labels = c("0-25", "25-50", "50-75", "75-100"),
           include.lowest = TRUE)

#  For "Pairwise Comparisons"
p_value_comparisons = list(
    c("0-25", "25-50"),
    c("0-25", "50-75"),
    c("0-25", "75-100"),
    c("25-50", "50-75"),
    c("25-50", "75-100"),
    c("50-75", "75-100")
)

# Plot
wuplot_boxplot(
    dataset = dataset.filtered, 
    xcol = 'editing_value', 
    ycol = feature.name,
    boxplot_options = list(
        title = FALSE,
        xlab = "Editing Level",
        ylab = feature.label,
        legend.title = 'editing_level',
        
        # Remove "jitter" and add "error bar"
        bxp.errorbar = TRUE,
        add = FALSE
    ),
    fonts = list(
        xlab = list(size = 20),
        ylab = list(size = 20),
        xy.text = list(size = 16)
    ),
    compare_means = list(
        comparisons = p_value_comparisons
    ), 
    exports = list(
        filename = GetoptLong::qq("boxplot-@{params$dataset_codename_str}-@{feature.name}.pdf")
    )
)

# ==========================
# BoxPlot - "editing_level" vs 
wuplot_boxplot(
    dataset = dataset.filtered, 
    xcol = feature.name,
    ycol = 'editing_value_orig', 
    boxplot_options = list(
        xlab = feature.label,
        ylab = "Editing Level",
        legend.title = feature.label,
        
        # Remove "jitter" and add "error bar"
        bxp.errorbar = TRUE
    ),
    fonts = list(
        xlab = list(size = 20),
        ylab = list(size = 20),
        xy.text = list(size = 16)
    ),
    compare_means = list(
        comparisons = list()
    ), 
    exports = list(
        filename = GetoptLong::qq("boxplot-@{params$dataset_codename_str}-@{feature.name}-reversed.pdf")
    )
)

```

```{r BoxPlot - d1_length - 2, echo=FALSE, fig.width=3.5, fig.height=6}

# ==========================
# Focused Version - "editing_level" sliced
dataset.filtered = dataset.filtered[ dataset.filtered[ , 'editing_value'] %in% c("0-25", "75-100") , ]
p_value_comparisons = list(
    c("0-25", "75-100")
)
wuplot_boxplot(
    dataset = dataset.filtered, 
    ycol = feature.name,
    xcol = 'editing_value', 
    boxplot_options = list(
        ylab = feature.label,
        xlab = "Editing Level",
        legend.title = "editing_level",
        
        # Remove "jitter" and add "error bar"
        bxp.errorbar = TRUE,
        add = FALSE
    ),
    fonts = list(
        xlab = list(size = 20),
        ylab = list(size = 20),
        xy.text = list(size = 16)
    ),
    compare_means = list(
        comparisons = p_value_comparisons
    ), 
    exports = list(
        width = 4,  # 72 DPI
        filename = GetoptLong::qq("boxplot-@{params$dataset_codename_str}-@{feature.name}-focused.pdf")
    )
)

```


## `u_count`

- Group "editing_value" based on the quantitle 

```{r BoxPlot - u_count, echo=FALSE, fig.width=6, fig.height=6}

# Feature Name
feature.name = 'u_count'
feature.label = 'u_count'

# Build "temp" dataset for plot
dataset.filtered = select(dataset, c('rna_id', 'editing_value', feature.name))
dataset.filtered = dataset.filtered[ is.na(dataset.filtered[ , feature.name]) == FALSE , ]

# Transform
# Use "quantitle" to split "editing level"
dataset.filtered$editing_value_orig = dataset.filtered$editing_value
probs <- seq(0, 1, by = 0.25)
quantiles <- quantile(dataset.filtered$editing_value, prob = probs)
dataset.filtered$editing_value <- cut(dataset.filtered$editing_value, 
           # quantiles,
           breaks = quantiles,
           labels = c("0-25", "25-50", "50-75", "75-100"),
           include.lowest = TRUE)

#  For "Pairwise Comparisons"
p_value_comparisons = list(
    c("0-25", "25-50"),
    c("0-25", "50-75"),
    c("0-25", "75-100"),
    c("25-50", "50-75"),
    c("25-50", "75-100"),
    c("50-75", "75-100")
)

# Plot
wuplot_boxplot(
    dataset = dataset.filtered, 
    xcol = 'editing_value', 
    ycol = feature.name,
    boxplot_options = list(
        title = FALSE,
        xlab = "Editing Level",
        ylab = feature.label,
        legend.title = 'editing_level',
        
        # Remove "jitter" and add "error bar"
        bxp.errorbar = TRUE,
        add = FALSE
    ),
    fonts = list(
        xlab = list(size = 20),
        ylab = list(size = 20),
        xy.text = list(size = 16)
    ),
    compare_means = list(
        comparisons = p_value_comparisons
    ), 
    exports = list(
        filename = GetoptLong::qq("boxplot-@{params$dataset_codename_str}-@{feature.name}.pdf")
    )
)

# ==========================
# BoxPlot - "editing_level" vs 
wuplot_boxplot(
    dataset = dataset.filtered, 
    xcol = feature.name,
    ycol = 'editing_value_orig', 
    boxplot_options = list(
        xlab = feature.label,
        ylab = "Editing Level",
        legend.title = feature.label,
        
        # Remove "jitter" and add "error bar"
        bxp.errorbar = TRUE
    ),
    fonts = list(
        xlab = list(size = 20),
        ylab = list(size = 20),
        xy.text = list(size = 16)
    ),
    compare_means = list(
        comparisons = list()
    ), 
    exports = list(
        filename = GetoptLong::qq("boxplot-@{params$dataset_codename_str}-@{feature.name}-reversed.pdf")
    )
)

```

```{r BoxPlot - u_count - 2, echo=FALSE, fig.width=3.5, fig.height=6}

# ==========================
# Focused Version - "editing_level" sliced
dataset.filtered = dataset.filtered[ dataset.filtered[ , 'editing_value'] %in% c("0-25", "75-100") , ]
p_value_comparisons = list(
    c("0-25", "75-100")
)
wuplot_boxplot(
    dataset = dataset.filtered, 
    ycol = feature.name,
    xcol = 'editing_value', 
    boxplot_options = list(
        ylab = feature.label,
        xlab = "Editing Level",
        legend.title = "editing_level",
        
        # Remove "jitter" and add "error bar"
        bxp.errorbar = TRUE,
        add = FALSE
    ),
    fonts = list(
        xlab = list(size = 20),
        ylab = list(size = 20),
        xy.text = list(size = 16)
    ),
    compare_means = list(
        comparisons = p_value_comparisons
    ), 
    exports = list(
        width = 4,  # 72 DPI
        filename = GetoptLong::qq("boxplot-@{params$dataset_codename_str}-@{feature.name}-focused.pdf")
    )
)

```


## `sim_nor_score`

- Group "editing_value" based on the quantitle 

```{r BoxPlot - sim_nor_score, echo=FALSE, fig.width=6, fig.height=6}

# Feature Name
feature.name = 'sim_nor_score'
feature.label = 'sim_nor_score'

# Build "temp" dataset for plot
dataset.filtered = select(dataset, c('rna_id', 'editing_value', 'num_mutations', feature.name))
dataset.filtered = dataset.filtered[ is.na(dataset.filtered[ , feature.name]) == FALSE , ]
dataset.filtered = dataset.filtered[ dataset.filtered[ , 'num_mutations'] > 0 , ]

# Transform - Num_Mutations
dataset.filtered$num_mutations_orig = dataset.filtered$num_mutations
transformFunc <- function(row){
    num_mutations <- row[5] # orig value
    
    if (num_mutations == 1) {
        value = "1"
    } else if (num_mutations == 2) {
        value = "2"
    } else {
        value = ">2"
    }

    return(value)
}
dataset.filtered$num_mutations <- apply(dataset.filtered, 1, transformFunc)

# Transform - Editing Level
# Use "quantitle" to split "editing level"
dataset.filtered$editing_value_orig = dataset.filtered$editing_value
probs <- seq(0, 1, by = 0.25)
quantiles <- quantile(dataset.filtered$editing_value, prob = probs)
dataset.filtered$editing_value <- cut(dataset.filtered$editing_value, 
           # quantiles,
           breaks = quantiles,
           labels = c("0-25", "25-50", "50-75", "75-100"),
           include.lowest = TRUE)

#  For "Pairwise Comparisons"
p_value_comparisons = list(
    c("0-25", "25-50"),
    c("0-25", "50-75"),
    c("0-25", "75-100"),
    c("25-50", "50-75"),
    c("25-50", "75-100"),
    c("50-75", "75-100")
)

# Plot
wuplot_boxplot(
    dataset = dataset.filtered, 
    xcol = 'editing_value', 
    ycol = feature.name,
    boxplot_options = list(
        title = FALSE,
        xlab = "Editing Level",
        ylab = feature.label,
        legend.title = 'editing_level',
        
        # Remove "jitter" and add "error bar"
        bxp.errorbar = TRUE
    ),
    fonts = list(
        xlab = list(size = 20),
        ylab = list(size = 20),
        xy.text = list(size = 16)
    ),
    compare_means = list(
        comparisons = p_value_comparisons
    ), 
    exports = list(
        filename = GetoptLong::qq("boxplot-@{params$dataset_codename_str}-@{feature.name}.pdf")
    )
)

# ==========================
# Against "num_mutations"
p_value_comparisons = list( 
    c("1", "2"),
    c("1", ">2"),
    c("2", ">2")
)
wuplot_boxplot(
    dataset = dataset.filtered, 
    xcol = 'num_mutations', 
    ycol = feature.name,
    boxplot_options = list(
        title = FALSE,
        xlab = "num_mutations",
        ylab = feature.label,
        legend.title = 'num_mutations',
        
        # Remove "jitter" and add "error bar"
        bxp.errorbar = TRUE
    ),
    fonts = list(
        xlab = list(size = 20),
        ylab = list(size = 20),
        xy.text = list(size = 16)
    ),
    compare_means = list(
        comparisons = p_value_comparisons
    ), 
    exports = list(
        filename = GetoptLong::qq("boxplot-@{params$dataset_codename_str}-@{feature.name}-against_num_mutations.pdf")
    )
)

```

```{r BoxPlot - sim_nor_score - 2, echo=FALSE, fig.width=3.5, fig.height=6}

# ==========================
# Focused Version - "editing_level" sliced
dataset.filtered = dataset.filtered[ dataset.filtered[ , 'editing_value'] %in% c("0-25", "75-100") , ]
p_value_comparisons = list(
    c("0-25", "75-100")
)
wuplot_boxplot(
    dataset = dataset.filtered, 
    ycol = feature.name,
    xcol = 'editing_value', 
    boxplot_options = list(
        ylab = feature.label,
        xlab = "Editing Level",
        legend.title = "editing_level",
        
        # Remove "jitter" and add "error bar"
        bxp.errorbar = TRUE
    ),
    fonts = list(
        xlab = list(size = 20),
        ylab = list(size = 20),
        xy.text = list(size = 16)
    ),
    compare_means = list(
        comparisons = p_value_comparisons
    ), 
    exports = list(
        width = 4,  # 72 DPI
        filename = GetoptLong::qq("boxplot-@{params$dataset_codename_str}-@{feature.name}-focused.pdf")
    )
)

```
